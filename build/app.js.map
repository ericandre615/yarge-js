{"version":3,"file":"app.js","sourceRoot":"","sources":["../src/app.ts"],"names":[],"mappings":"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","sourcesContent":["import './vendor/raf-polyfill.js';\n\nimport getGlContext from './lib/gl.js';\n\nconst getCanvas = (canvasId = ''): HTMLCanvasElement => document.getElementById(canvasId) as HTMLCanvasElement;\n\nconst PAUSE = 80;\n\ntype App = {\n  gl: WebGLRenderingContext | undefined, // TODO: use Maybe/Option type instead\n  canvas: HTMLCanvasElement | undefined,\n  run: ((props: object) => Promise<number>) | undefined,\n  state: object | undefined,\n  extensions: [object], //?\n}\n\nconst app: App = {\n  gl: undefined,\n  canvas: undefined,\n  run: undefined,\n  state: undefined,\n  extensions: [{}],\n};\n\nconst runApp = (app: any) =>  async ({\n  // @ts-ignore\n  update = (state) => state,\n} = {}) => {\n  let rafId = 0; // use 0 as \"uninitialized\" value because typescript is having problems with undefined in this case\n  const { gl, canvas } = app;\n  app.state.setIsRunning(true);\n\n  const internalUpdate = (time: number) => {\n    canvas.style.width = canvas.width;\n    canvas.style.height = canvas.height;\n\n    gl.viewport(0, 0, canvas.width, canvas.height);\n    gl.clearColor(...app.state.clearColor());\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    update({ ...app.state, time });\n\n    rafId = requestAnimationFrame(internalUpdate);\n  };\n\n  const pauseApp = (e: KeyboardEvent) => {\n    if (e.keyCode === PAUSE) {\n      if (app.state.isRunning()) {\n        cancelAnimationFrame(rafId);\n      } else{\n        rafId = requestAnimationFrame(internalUpdate);\n      }\n\n      return app.state.toggleIsRunning();\n    }\n  };\n\n  document.addEventListener('keydown', pauseApp, false);\n\n  rafId = requestAnimationFrame(internalUpdate);\n\n  return rafId;\n};\n\ntype ClearColor = [number, number, number, number];\n\nconst defaultClearColor: ClearColor = [0.4, 0.2, 0.6, 1.0];\ntype AppState = {\n  clearColor: ClearColor,\n  isRunning: boolean,\n  time: number,\n};\n\nconst appState: AppState = {\n  clearColor: defaultClearColor,\n  isRunning: false,\n  time: 0,\n};\n\ntype GenericObject<T> = T & { [key: string]: unknown };\ntype InternalState = GenericObject<{\n  clearColor: [number, number, number, number],\n  isRunning: boolean,\n  time: number\n}>;\n\nconst createState = (internalState: InternalState) => {\n  const state = internalState;\n\n  return {\n    isRunning: () => state.isRunning,\n    setIsRunning: (isRunning: boolean) => state.isRunning = isRunning,\n    toggleIsRunning: () => state.isRunning = !state.isRunning,\n    clearColor: () => state.clearColor,\n    setClearColor: (r: number , g: number, b: number, a: number) => state.clearColor = [r, g, b, a],\n  };\n};\n\nconst createApp = (canvasId = '') => {\n  const gl = getGlContext(canvasId);\n\n  app.gl = gl;\n  app.canvas = getCanvas(canvasId) || undefined; // TODO: why? because DOM API types and the functions for them may return null? Shouldn't that be considered in TS's built in DOM API Types?\n  app.run = runApp(app);\n  app.state = createState(appState);\n  app.extensions = [\n    { 'vertex_array_object': (\n      gl.getExtension('OES_vertex_array_object') ||\n      gl.getExtension('MOZ_OES_vertex_array_object') ||\n      gl.getExtension('WEBKIT_OES_vertex_array_object')\n    ) },\n  ];\n\n  return app;\n};\n\nexport default createApp;\n"]}