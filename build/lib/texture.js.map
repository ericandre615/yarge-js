{"version":3,"file":"texture.js","sourceRoot":"","sources":["../../src/lib/texture.js"],"names":[],"mappings":"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","sourcesContent":["import loadImage from '../loaders/image.js';\n\nconst isPowerOf2 = value => ((value & (value - 1)) == 0);\n\nexport const createTexture = gl => async (\n  imagePath = '',\n  options = {},\n) => {\n  const image = await loadImage(imagePath);\n\n  const textureId = gl.createTexture();\n\n  gl.enable(gl.BLEND);\n  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n  gl.bindTexture(gl.TEXTURE_2D, textureId);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  // Check if the image is a power of 2 in both dimensions.\n  if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n  // Yes, it's a power of 2. Generate mips.\n    gl.generateMipmap(gl.TEXTURE_2D);\n  } else {\n    // No, it's not a power of 2. Turn off mips and set wrapping to clamp to edge\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  }\n\n  return {\n    textureId,\n    getDimensions: () => ([image.width, image.height]),\n    bind: () => gl.bindTexture(gl.TEXTURE_2D, textureId),\n    bindToUnit: unit => {\n      gl.activeTexture(gl.TEXTURE0 + unit);\n      gl.bindTexture(gl.TEXTURE_2D, textureId);\n    },\n    unbind: () => gl.bindTexture(gl.TEXTURE_2D, null),\n    detach: () => gl.deleteTextures(1, textureId),\n  };\n};\n\nexport default createTexture;\n"]}